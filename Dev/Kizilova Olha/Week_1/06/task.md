# Детальные задачи по CRM системе (Таланты)

**Дата:** 06.11.2025
**Источник:** Обсуждения и заметки из daily.md

---

## ЗАДАЧА 1: Автоматическая деактивация уволенных сотрудников

**Описание:** Если сотрудник уволен, автоматически ставить его как забаненного (неактивного)

### Подзадачи:

#### 1.1 Backend - Логика деактивации
- [ ] Определить статус "уволен" в системе (какое значение в БД?)
- [ ] Создать поле `is_active` или `is_banned` в таблице talents (если нет)
- [ ] Написать логику: при смене статуса на "уволен" → автоматически `is_active = false`
- [ ] Добавить проверку: забаненный сотрудник не может войти в систему
- [ ] Написать миграцию БД для нового поля (если требуется)

#### 1.2 Frontend - Отображение
- [ ] Показывать индикатор "Неактивен" для забаненных сотрудников
- [ ] Заблокировать возможность редактирования неактивных сотрудников
- [ ] Добавить фильтр "Активные/Неактивные" в список талантов

#### 1.3 Права доступа
- [ ] Только админ может разбанить сотрудника
- [ ] Добавить подтверждение при бане: "Вы уверены, что хотите деактивировать сотрудника?"

#### 1.4 Тестирование
- [ ] Протестировать: уволенный сотрудник → автоматически banned
- [ ] Протестировать: забаненный не может войти в систему
- [ ] Протестировать: админ может разбанить

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend) + Лиля (frontend)
**Оценка времени:** 3-4 часа

---

## ЗАДАЧА 2: Объединение Notes и резюме в одно поле

**Описание:** Перенести все Notes и резюме в одно поле

### Подзадачи:

#### 2.1 Анализ текущей структуры
- [ ] Проверить где сейчас хранятся Notes (поле, таблица)
- [ ] Проверить где сейчас хранится Resume/CV (поле, таблица, файл?)
- [ ] Определить формат нового объединенного поля

#### 2.2 Backend - Миграция данных
- [ ] Создать новое поле `unified_notes` (или переименовать существующее)
- [ ] Написать скрипт миграции:
  - Объединить данные из Notes и Resume
  - Сохранить в новое поле
  - Формат: "Notes: [текст]\n\nResume: [текст]" или JSON
- [ ] Создать backup перед миграцией
- [ ] Выполнить миграцию на dev-среде
- [ ] Проверить результаты миграции

#### 2.3 Backend - API
- [ ] Обновить API endpoint для получения объединенных notes
- [ ] Обновить API endpoint для сохранения объединенных notes
- [ ] Удалить старые поля Notes и Resume (или пометить deprecated)

#### 2.4 Frontend - Интерфейс
- [ ] Создать единое поле редактирования для Notes + Resume
- [ ] Добавить разделители или вкладки внутри поля (опционально)
- [ ] Обновить отображение в карточке таланта
- [ ] Обновить отображение в списке талантов

#### 2.5 Тестирование
- [ ] Протестировать: старые данные корректно объединены
- [ ] Протестировать: можно редактировать объединенное поле
- [ ] Протестировать: данные сохраняются корректно
- [ ] Протестировать: нет потери данных при миграции

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend + миграция) + Лиля (frontend)
**Оценка времени:** 4-6 часов
**Риск:** Миграция данных - нужен тщательный backup

---

## ЗАДАЧА 3: Система коротких ссылок (самостоятельное управление)

**Описание:** Реализовать систему коротких ссылок, которой можем управлять сами

### Подзадачи:

#### 3.1 Анализ требований
- [ ] Определить: для чего нужны короткие ссылки? (шеринг профилей, приглашения?)
- [ ] Определить формат: `domain.com/t/ABC123` или `domain.com/short/XYZ`
- [ ] Определить длину короткой ссылки (6-8 символов?)
- [ ] Определить: уникальные или можно повторы?

#### 3.2 Backend - Таблица ссылок
- [ ] Создать таблицу `short_links`:
  - `id` (primary key)
  - `short_code` (уникальный код, varchar(10))
  - `original_url` (полный URL)
  - `talent_id` (FK к таланту, если применимо)
  - `created_by` (кто создал)
  - `created_at`
  - `expires_at` (опционально)
  - `clicks_count` (счетчик переходов)
- [ ] Создать миграцию для новой таблицы

#### 3.3 Backend - Генерация коротких ссылок
- [ ] Функция генерации уникального short_code (base62, nanoid, или custom)
- [ ] Проверка на уникальность кода
- [ ] API endpoint: `POST /api/short-links` - создать короткую ссылку
- [ ] API endpoint: `GET /api/short-links/:code` - получить оригинальный URL
- [ ] API endpoint: `GET /api/short-links` - список всех коротких ссылок
- [ ] API endpoint: `DELETE /api/short-links/:id` - удалить короткую ссылку

#### 3.4 Backend - Редирект
- [ ] Создать роут `GET /:short_code` - редирект на оригинальный URL
- [ ] Увеличивать счетчик `clicks_count` при каждом переходе
- [ ] Обработка: если short_code не найден → 404
- [ ] Обработка: если ссылка истекла → показать сообщение

#### 3.5 Frontend - Управление ссылками
- [ ] Страница управления короткими ссылками
- [ ] Кнопка "Создать короткую ссылку" в карточке таланта
- [ ] Показывать: short_code, original_url, количество кликов
- [ ] Кнопка "Копировать ссылку" (copy to clipboard)
- [ ] Возможность удалить короткую ссылку

#### 3.6 Аналитика
- [ ] Показывать количество переходов по каждой ссылке
- [ ] Опционально: дата последнего перехода
- [ ] Опционально: статистика по дням

#### 3.7 Тестирование
- [ ] Тест: создание короткой ссылки
- [ ] Тест: редирект работает корректно
- [ ] Тест: счетчик кликов увеличивается
- [ ] Тест: уникальность short_code
- [ ] Тест: удаление ссылки

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend) + Лиля (frontend)
**Оценка времени:** 1 день (6-8 часов)

---

## ЗАДАЧА 4: Ссылки отдельной таблицей (как в старой CRM)

**Описание:** Хранить все ссылки таланта в отдельной таблице (как в прошлой CRM)

### Подзадачи:

#### 4.1 Анализ старой структуры
- [ ] Посмотреть как было реализовано в старой CRM
- [ ] Определить какие типы ссылок нужны:
  - LinkedIn
  - Portfolio
  - GitHub
  - Behance
  - Facebook
  - Instagram
  - Другие социальные сети
  - Личный сайт
  - Другие

#### 4.2 Backend - Таблица ссылок
- [ ] Создать таблицу `talent_links`:
  - `id` (primary key)
  - `talent_id` (FK к таланту)
  - `link_type` (тип: linkedin, portfolio, github, etc.)
  - `url` (полный URL)
  - `label` (название ссылки, опционально)
  - `is_primary` (основная ссылка для этого типа?)
  - `created_at`
  - `updated_at`
- [ ] Создать миграцию для новой таблицы

#### 4.3 Backend - Миграция существующих ссылок
- [ ] Найти все поля со ссылками в текущей структуре talent
- [ ] Написать скрипт миграции:
  - Перенести LinkedIn URL → talent_links (type: linkedin)
  - Перенести Portfolio URL → talent_links (type: portfolio)
  - Перенести другие URLs
- [ ] Backup перед миграцией
- [ ] Выполнить миграцию на dev

#### 4.4 Backend - API
- [ ] API endpoint: `GET /api/talents/:id/links` - получить все ссылки таланта
- [ ] API endpoint: `POST /api/talents/:id/links` - добавить ссылку
- [ ] API endpoint: `PUT /api/talents/:id/links/:linkId` - обновить ссылку
- [ ] API endpoint: `DELETE /api/talents/:id/links/:linkId` - удалить ссылку
- [ ] Валидация URL формата

#### 4.5 Frontend - Отображение ссылок
- [ ] Секция "Ссылки" в карточке таланта
- [ ] Показывать иконки для каждого типа ссылки (LinkedIn, GitHub, etc.)
- [ ] Ссылки кликабельны и открываются в новой вкладке
- [ ] Группировка по типам

#### 4.6 Frontend - Редактирование ссылок
- [ ] Кнопка "Добавить ссылку"
- [ ] Модальное окно / форма:
  - Select для выбора типа ссылки
  - Input для URL
  - Input для названия (опционально)
- [ ] Кнопка "Удалить" для каждой ссылки
- [ ] Возможность редактировать существующую ссылку

#### 4.7 Тестирование
- [ ] Тест: добавление новой ссылки
- [ ] Тест: редактирование ссылки
- [ ] Тест: удаление ссылки
- [ ] Тест: валидация URL
- [ ] Тест: миграция старых данных прошла корректно

**Приоритет:** HIGH (связано с задачей 3)
**Исполнитель:** Оля (backend + миграция) + Лиля (frontend)
**Оценка времени:** 1 день (6-8 часов)
**Зависимость:** Желательно сделать вместе с задачей 3 (система коротких ссылок)

---

## ЗАДАЧА 5: Просмотр медиа у таланта

**Описание:** Добавить возможность просмотра медиафайлов (фото, видео) в профиле таланта

### Подзадачи:

#### 5.1 Анализ требований
- [ ] Определить типы медиа:
  - Фото профиля
  - Портфолио (фото работ)
  - Видео-презентации
  - Скриншоты проектов
  - Другие документы (PDF резюме)
- [ ] Определить где хранить файлы (сервер, S3, Cloudinary?)
- [ ] Определить максимальный размер файла
- [ ] Определить форматы файлов (jpg, png, mp4, pdf?)

#### 5.2 Backend - Таблица медиафайлов
- [ ] Создать таблицу `talent_media`:
  - `id` (primary key)
  - `talent_id` (FK к таланту)
  - `media_type` (photo, video, document)
  - `file_name` (оригинальное имя файла)
  - `file_path` (путь к файлу на сервере/S3)
  - `file_url` (публичный URL)
  - `file_size` (размер в байтах)
  - `mime_type` (image/jpeg, video/mp4, etc.)
  - `title` (название, опционально)
  - `description` (описание, опционально)
  - `is_profile_photo` (это главное фото профиля?)
  - `sort_order` (порядок отображения)
  - `uploaded_by` (кто загрузил)
  - `created_at`
- [ ] Создать миграцию для новой таблицы

#### 5.3 Backend - Загрузка файлов
- [ ] API endpoint: `POST /api/talents/:id/media` - загрузить файл
  - Валидация типа файла
  - Валидация размера файла
  - Генерация уникального имени файла
  - Сохранение на сервере/S3
  - Создание thumbnail для фото (опционально)
- [ ] Обработка ошибок загрузки
- [ ] Ограничение: макс N файлов на таланта

#### 5.4 Backend - Получение медиа
- [ ] API endpoint: `GET /api/talents/:id/media` - получить все медиа таланта
- [ ] API endpoint: `GET /api/talents/:id/media/:mediaId` - получить конкретный файл
- [ ] API endpoint: `DELETE /api/talents/:id/media/:mediaId` - удалить файл
- [ ] API endpoint: `PUT /api/talents/:id/media/:mediaId` - обновить метаданные
- [ ] Генерация подписанных URL для приватных файлов (если нужно)

#### 5.5 Frontend - Галерея медиа
- [ ] Секция "Медиа" в карточке таланта
- [ ] Отображение фото в виде галереи (grid layout)
- [ ] Превью для видео (thumbnail + play button)
- [ ] Иконки для документов (PDF, DOC)
- [ ] Клик на фото → открытие в полноэкранном режиме (lightbox)
- [ ] Навигация между фото в lightbox (стрелки влево/вправо)

#### 5.6 Frontend - Загрузка медиа
- [ ] Кнопка "Добавить медиа" / "Загрузить файл"
- [ ] Drag & Drop зона для загрузки файлов
- [ ] Progress bar при загрузке
- [ ] Превью файла перед загрузкой
- [ ] Возможность добавить название и описание
- [ ] Кнопка "Сделать фото профиля" для фотографий

#### 5.7 Frontend - Управление медиа
- [ ] Кнопка "Удалить" для каждого файла
- [ ] Подтверждение при удалении
- [ ] Возможность редактировать название/описание
- [ ] Drag & Drop для изменения порядка фото
- [ ] Фильтр по типу: "Все / Фото / Видео / Документы"

#### 5.8 Видео плеер
- [ ] Встроенный видео плеер для MP4 файлов
- [ ] Контролы: play, pause, volume, fullscreen
- [ ] Поддержка различных форматов (mp4, webm, mov)

#### 5.9 Оптимизация
- [ ] Lazy loading для изображений
- [ ] Генерация thumbnails для больших фото
- [ ] Оптимизация размера изображений при загрузке
- [ ] CDN для быстрой загрузки (если используется)

#### 5.10 Тестирование
- [ ] Тест: загрузка фото
- [ ] Тест: загрузка видео
- [ ] Тест: загрузка документа (PDF)
- [ ] Тест: удаление файла
- [ ] Тест: установка фото профиля
- [ ] Тест: галерея отображается корректно
- [ ] Тест: lightbox работает
- [ ] Тест: валидация типа и размера файла

**Приоритет:** MEDIUM-HIGH
**Исполнитель:** Оля (backend + storage) + Лиля (frontend + UI)
**Оценка времени:** 2 дня (12-16 часов)
**Зависимость:** Нужно решить вопрос с хранилищем файлов (локально или S3/Cloudinary)

---

## ИТОГОВАЯ ОЦЕНКА

### Общее время на все задачи:
- **Задача 1:** 3-4 часа
- **Задача 2:** 4-6 часов
- **Задача 3:** 6-8 часов (1 день)
- **Задача 4:** 6-8 часов (1 день)
- **Задача 5:** 12-16 часов (2 дня)

**Итого:** ~40-50 часов (5-6 рабочих дней)

### Рекомендуемый порядок выполнения:

1. **Задача 4** (Ссылки в отдельной таблице) - HIGH приоритет, база для задачи 3
2. **Задача 3** (Короткие ссылки) - зависит от задачи 4
3. **Задача 5** (Медиа) - независимая, можно делать параллельно
4. **Задача 2** (Объединение Notes) - можно делать параллельно
5. **Задача 1** (Автобан уволенных) - быстрая задача, можно в конце

### Распределение:

**Оля (Backend):**
- Все задачи по созданию таблиц, миграций, API
- Оценка: 25-30 часов

**Лиля (Frontend):**
- Все задачи по интерфейсам, формам, отображению
- Оценка: 15-20 часов

---

## ЗАДАЧА 6: Переделать на токены доступа (Token-based Authentication)

**Описание:** Переделать аутентификацию на token-based систему

### Подзадачи:

#### 6.1 Анализ текущей системы
- [ ] Проверить текущую систему аутентификации (сессии, cookies?)
- [ ] Определить проблемы текущей системы
- [ ] Выбрать тип токенов: JWT, OAuth2, или custom?
- [ ] Определить срок жизни токенов (access token, refresh token)

#### 6.2 Backend - Генерация токенов
- [ ] Установить библиотеку для работы с JWT (jsonwebtoken, jose, или аналог)
- [ ] Создать endpoint `/api/auth/login` - генерация access token
- [ ] Создать endpoint `/api/auth/refresh` - обновление токена
- [ ] Создать endpoint `/api/auth/logout` - инвалидация токена
- [ ] Определить payload токена (user_id, role, permissions, exp)
- [ ] Создать секретный ключ для подписи токенов (env variable)

#### 6.3 Backend - Валидация токенов
- [ ] Создать middleware для проверки токенов на каждом защищенном роуте
- [ ] Проверка: токен валидный и не истек
- [ ] Проверка: токен не в blacklist (для logout)
- [ ] Извлечение user данных из токена
- [ ] Обработка ошибок: expired token, invalid token, missing token

#### 6.4 Backend - Refresh Token механизм
- [ ] Создать таблицу `refresh_tokens`:
  - `id` (primary key)
  - `user_id` (FK к пользователю)
  - `token` (refresh token)
  - `expires_at`
  - `created_at`
  - `is_revoked` (отозван или нет)
- [ ] Логика обновления access token через refresh token
- [ ] Автоматическая очистка истекших refresh tokens

#### 6.5 Backend - Blacklist для logout
- [ ] Создать таблицу `token_blacklist` или использовать Redis
- [ ] При logout добавлять токен в blacklist
- [ ] Middleware проверяет не находится ли токен в blacklist

#### 6.6 Backend - Права доступа через токены
- [ ] Добавить roles/permissions в payload токена
- [ ] Middleware для проверки прав: `hasRole`, `hasPermission`
- [ ] Обновление прав без перелогина (короткий срок жизни access token)

#### 6.7 Frontend - Хранение токенов
- [ ] Решить где хранить токены:
  - localStorage (проще, но уязвимо к XSS)
  - httpOnly cookies (безопаснее)
  - sessionStorage
- [ ] Сохранение access token и refresh token после логина
- [ ] Автоматическое добавление токена в headers всех запросов

#### 6.8 Frontend - Interceptors для API
- [ ] Axios/Fetch interceptor: добавить токен в header `Authorization: Bearer {token}`
- [ ] Interceptor для обработки 401 Unauthorized
- [ ] Автоматическое обновление токена при получении 401
- [ ] Редирект на login если refresh token тоже истек

#### 6.9 Frontend - Автоматическое обновление токена
- [ ] Проверка срока жизни токена перед каждым запросом
- [ ] Автоматический refresh за N минут до истечения
- [ ] Обработка одновременных запросов при refresh

#### 6.10 Миграция существующих пользователей
- [ ] Создать миграцию для добавления полей токенов
- [ ] Backup текущей системы
- [ ] План постепенного перехода (старая + новая система параллельно?)
- [ ] Тестирование на dev среде

#### 6.11 Безопасность
- [ ] HTTPS обязательно для передачи токенов
- [ ] Защита от CSRF атак
- [ ] Rate limiting на login endpoint
- [ ] Логирование подозрительной активности (неудачные попытки входа)

#### 6.12 Тестирование
- [ ] Тест: успешный login → получение токенов
- [ ] Тест: защищенный endpoint требует токен
- [ ] Тест: истекший токен → 401
- [ ] Тест: refresh token обновляет access token
- [ ] Тест: logout инвалидирует токены
- [ ] Тест: права доступа проверяются корректно

**Приоритет:** HIGH
**Исполнитель:** Оля (backend) + Лиля (frontend - interceptors)
**Оценка времени:** 2-3 дня (16-24 часа)
**Зависимость:** После завершения deep research по системе доступов

---

## ЗАДАЧА 7: Статистика для рекрутеров

**Описание:** Вывести статистику для рекрутеров по их работе с кандидатами

### Подзадачи:

#### 7.1 Анализ требований
- [ ] Определить какую статистику нужно показывать:
  - Количество кандидатов по статусам
  - Конверсия по воронке (видео → интервью → approved)
  - Количество кандидатов добавленных за период
  - Среднее время на этапе
  - ТОП рекрутеров по результатам
  - Другие метрики
- [ ] Определить период: день, неделя, месяц, год, custom range?
- [ ] Определить фильтры: по департаменту, профессии, статусу

#### 7.2 Backend - Таблица статистики (опционально)
- [ ] Решить: считать on-the-fly или сохранять агрегированные данные?
- [ ] Если сохранять: создать таблицу `recruiter_stats`:
  - `id`
  - `recruiter_id`
  - `date`
  - `candidates_added` (количество добавленных)
  - `candidates_approved` (количество одобренных)
  - `candidates_rejected` (количество отклоненных)
  - `avg_time_to_approval` (среднее время до одобрения)
  - и т.д.

#### 7.3 Backend - API для статистики
- [ ] API endpoint: `GET /api/recruiters/:id/stats` - статистика конкретного рекрутера
- [ ] API endpoint: `GET /api/stats/recruiters` - общая статистика по всем рекрутерам
- [ ] Параметры фильтрации:
  - `start_date`, `end_date` (период)
  - `department` (департамент)
  - `profession` (профессия)
  - `status` (статус кандидата)
- [ ] Оптимизация запросов (индексы, агрегация)

#### 7.4 Backend - Расчет метрик
- [ ] Количество кандидатов по статусам (group by status)
- [ ] Конверсия: % кандидатов перешедших на следующий этап
- [ ] Среднее время на каждом этапе
- [ ] Тренды: сравнение с предыдущим периодом
- [ ] Рейтинг рекрутеров (сортировка по результатам)

#### 7.5 Frontend - Dashboard статистики
- [ ] Страница "Статистика рекрутеров"
- [ ] Карточки с ключевыми метриками:
  - Всего кандидатов
  - Одобрено
  - Отклонено
  - В процессе
- [ ] Фильтры: период, департамент, профессия

#### 7.6 Frontend - Графики и визуализация
- [ ] Установить библиотеку для графиков (Chart.js, Recharts, или аналог)
- [ ] График: количество кандидатов по статусам (pie chart)
- [ ] График: динамика добавления кандидатов (line chart)
- [ ] График: конверсия воронки (funnel chart)
- [ ] Таблица: рейтинг рекрутеров

#### 7.7 Frontend - Экспорт статистики
- [ ] Кнопка "Экспорт в Excel" для статистики
- [ ] Кнопка "Экспорт в PDF" (опционально)
- [ ] Формирование отчета с графиками

#### 7.8 Права доступа
- [ ] Рекрутер видит только свою статистику
- [ ] HR/Админ видят статистику всех рекрутеров
- [ ] Менеджер видит статистику своей команды

#### 7.9 Тестирование
- [ ] Тест: статистика считается корректно
- [ ] Тест: фильтры работают
- [ ] Тест: графики отображаются
- [ ] Тест: права доступа соблюдаются

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend + расчеты) + Лиля (frontend + графики)
**Оценка времени:** 2 дня (12-16 часов)
**Статус:** После обсуждения требований с командой

---

## ЗАДАЧА 8: Вкладки по статусам (история изменений)

**Описание:** Вывести отдельные страницы/вкладки по статусам с историей изменений

### Подзадачи:

#### 8.1 Анализ требований
- [ ] Определить какие статусы нужно отслеживать:
  - Видео
  - Интервью
  - Approved
  - Not approved
  - Другие
- [ ] Определить что показывать в истории:
  - Кто изменил статус
  - Когда изменил
  - Причина изменения (если есть)
  - Из какого статуса в какой

#### 8.2 Backend - Использование таблицы Events
- [ ] Проверить структуру таблицы `Events` (какие поля есть)
- [ ] Убедиться что в Events сохраняются изменения статусов:
  - `event_type` = 'status_change' (или аналог)
  - `entity_type` = 'talent'
  - `entity_id` = talent_id
  - `old_value` = предыдущий статус (from_status)
  - `new_value` = новый статус (to_status)
  - `user_id` = кто изменил
  - `created_at` = когда изменил
  - `metadata` (JSON) = reason, notes, и т.д.
- [ ] Если структура Events не подходит - адаптировать её

#### 8.3 Backend - Автоматическое логирование изменений в Events
- [ ] Проверить существует ли уже логирование изменений статуса в Events
- [ ] Если нет: создать middleware/trigger при изменении статуса таланта
- [ ] Автоматическое сохранение события в таблицу Events:
  - event_type: 'talent_status_change'
  - old_value: предыдущий статус
  - new_value: новый статус
  - user_id: кто изменил
  - metadata: { reason, notes }
- [ ] Запись текущего пользователя (кто изменил)

#### 8.4 Backend - API для истории из Events
- [ ] API endpoint: `GET /api/talents/:id/status-history` - история конкретного таланта
  - Читать из Events где entity_id = talent_id AND event_type = 'talent_status_change'
  - Сортировка по created_at DESC
- [ ] API endpoint: `GET /api/talents/by-status/:status` - список талантов с определенным статусом
- [ ] API endpoint: `GET /api/talents/status-transitions` - переходы между статусами (аналитика)
  - Агрегация из Events: группировка по old_value → new_value
- [ ] Параметры фильтрации:
  - `from_status` (old_value)
  - `to_status` (new_value)
  - `start_date`, `end_date` (created_at)
  - `changed_by` (user_id)

#### 8.5 Frontend - Вкладки по статусам
- [ ] Создать вкладки в главной странице талантов:
  - Все
  - Видео
  - Интервью
  - Approved
  - Not Approved
  - Другие статусы
- [ ] Каждая вкладка показывает список талантов с этим статусом
- [ ] Счетчик количества в каждом статусе

#### 8.6 Frontend - История изменений статуса
- [ ] Секция "История статусов" в карточке таланта
- [ ] Timeline визуализация:
  - Дата и время
  - Из какого статуса в какой
  - Кто изменил (с аватаром/именем)
  - Причина (если указана)
- [ ] Фильтр по периоду

#### 8.7 Frontend - Страница "Переходы статусов"
- [ ] Отдельная страница для аналитики переходов
- [ ] Список: кто был в статусе X и перешел в статус Y
- [ ] Фильтры:
  - Период
  - Департамент
  - Рекрутер
  - Из какого статуса → в какой статус

#### 8.8 Frontend - Визуализация воронки
- [ ] Funnel chart: сколько кандидатов на каждом этапе
- [ ] Показывать % отсева на каждом этапе
- [ ] Клик на этап → список кандидатов

#### 8.9 Миграция существующих данных
- [ ] Создать начальную запись в истории для всех текущих талантов
- [ ] Установить `from_status = NULL`, `to_status = current_status`
- [ ] `changed_at = talent.created_at`

#### 8.10 Тестирование
- [ ] Тест: изменение статуса → запись в историю
- [ ] Тест: история отображается корректно
- [ ] Тест: вкладки фильтруют талантов по статусу
- [ ] Тест: аналитика переходов корректна

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend + история) + Лиля (frontend + вкладки)
**Оценка времени:** 2 дня (12-16 часов)
**Заметка:** "Это не проблема" - относительно простая задача
**Статус:** ✅ Выполнена

---

## ЗАДАЧА 9: Кнопка экспорта данных в Excel

**Описание:** Сделать кнопку для экспорта данных кандидатов в Excel файл

### Подзадачи:

#### 9.1 Анализ требований
- [ ] Определить какие поля экспортировать:
  - ✅ ID
  - ✅ Name
  - ✅ Email
  - ✅ Department
  - ✅ Profession
  - ✅ Status
  - ✅ Last contact date
  - ✅ Link (профиль)
  - ✅ Recruiter (кто добавил)
  - Другие поля?
- [ ] Формат файла: .xlsx (Excel) или .csv?
- [ ] Экспортировать все или с фильтрами?

#### 9.2 Backend - Библиотека для Excel
- [ ] Выбрать библиотеку:
  - Node.js: exceljs, xlsx, fast-excel
  - Python: openpyxl, pandas
  - Другие
- [ ] Установить выбранную библиотеку

#### 9.3 Backend - API для экспорта
- [ ] API endpoint: `GET /api/talents/export` - экспорт талантов в Excel
- [ ] Параметры фильтрации (опционально):
  - `status` - экспортировать только с определенным статусом
  - `department` - только из департамента
  - `recruiter_id` - только от определенного рекрутера
  - `start_date`, `end_date` - за период
  - `ids[]` - экспорт выбранных талантов
- [ ] Response: файл Excel для скачивания

#### 9.4 Backend - Генерация Excel файла
- [ ] Получить данные талантов из БД
- [ ] Создать Excel workbook
- [ ] Добавить header row с названиями колонок
- [ ] Заполнить данными (каждый талант = строка)
- [ ] Форматирование:
  - Header: жирный шрифт, фон
  - Автоширина колонок
  - Фильтры на header row
- [ ] Сохранить как buffer для отправки

#### 9.5 Backend - Оптимизация для больших данных
- [ ] Streaming для больших файлов (>1000 записей)
- [ ] Пагинация при чтении из БД
- [ ] Ограничение на количество экспортируемых записей (макс 10000?)

#### 9.6 Frontend - Кнопка экспорта
- [ ] Добавить кнопку "Экспорт в Excel" на странице списка талантов
- [ ] Иконка Excel + текст кнопки
- [ ] Loading state при генерации файла

#### 9.7 Frontend - Модальное окно настроек экспорта (опционально)
- [ ] Модальное окно "Настройки экспорта":
  - Выбор полей для экспорта (checkbox список)
  - Выбор фильтров
  - Экспорт: "Все" или "Выбранные" таланты
- [ ] Кнопка "Экспортировать"

#### 9.8 Frontend - Скачивание файла
- [ ] Запрос к API endpoint
- [ ] Получение blob файла
- [ ] Автоматическое скачивание через `<a download>`
- [ ] Имя файла: `talents_export_YYYY-MM-DD.xlsx`

#### 9.9 Frontend - Индикация прогресса
- [ ] Progress bar при генерации (если долго)
- [ ] Уведомление "Файл готов для скачивания"
- [ ] Обработка ошибок (слишком много данных, timeout)

#### 9.10 Права доступа
- [ ] Только HR/Админ/Рекрутеры могут экспортировать
- [ ] Рекрутер экспортирует только своих кандидатов
- [ ] Админ экспортирует всех

#### 9.11 Логирование экспорта
- [ ] Записывать кто, когда, сколько записей экспортировал
- [ ] Таблица `export_log`:
  - `id`
  - `user_id`
  - `export_type` (talents, jobs, etc.)
  - `records_count`
  - `filters` (JSON с фильтрами)
  - `created_at`

#### 9.12 Тестирование
- [ ] Тест: экспорт создает корректный Excel файл
- [ ] Тест: все поля присутствуют
- [ ] Тест: фильтры работают
- [ ] Тест: файл скачивается автоматически
- [ ] Тест: права доступа соблюдаются
- [ ] Тест: большое количество данных (стресс-тест)

**Приоритет:** HIGH
**Исполнитель:** Оля (backend + генерация Excel) + Лиля (frontend + UI)
**Оценка времени:** 1-1.5 дня (8-12 часов)
**Статус:** После встречи с Женей (встреча была ✅) - можно начинать
**Заметка:** Вместо старого скрипта, который был привязан к Bootstrap атрибутам 3CM

---

## ОБНОВЛЕННАЯ ИТОГОВАЯ ОЦЕНКА

### Общее время на все задачи (1-9):
- **Задача 1:** 3-4 часа
- **Задача 2:** 4-6 часов
- **Задача 3:** 6-8 часов (1 день)
- **Задача 4:** 6-8 часов (1 день)
- **Задача 5:** 12-16 часов (2 дня)
- **Задача 6:** 16-24 часа (2-3 дня)
- **Задача 7:** 12-16 часов (2 дня)
- **Задача 8:** 12-16 часов (2 дня)
- **Задача 9:** 8-12 часов (1-1.5 дня)

**Итого:** ~90-120 часов (11-15 рабочих дней)

### Рекомендуемый порядок выполнения:

**Высокий приоритет (делать первыми):**
1. **Задача 9** - Экспорт в Excel (HIGH, готова к старту)
2. **Задача 4** - Ссылки в отдельной таблице (HIGH)
3. **Задача 6** - Token-based auth (HIGH, после deep research)

**Средний приоритет (делать параллельно):**
4. **Задача 5** - Медиа (MEDIUM-HIGH)
5. **Задача 3** - Короткие ссылки (MEDIUM)
6. **Задача 7** - Статистика рекрутеров (MEDIUM)
7. **Задача 8** - Вкладки по статусам (MEDIUM)

**Низкий приоритет (делать в конце):**
8. **Задача 2** - Объединение Notes (MEDIUM)
9. **Задача 1** - Автобан уволенных (MEDIUM)

### Распределение:

**Оля (Backend):**
- Все задачи по созданию таблиц, миграций, API, токенов, экспорта
- Оценка: 55-70 часов

**Лиля (Frontend):**
- Все задачи по интерфейсам, формам, отображению, графикам
- Оценка: 35-50 часов

---

**Дата создания:** 06.11.2025
**Последнее обновление:** 06.11.2025
**Следующий шаг:** Начать с задачи 9 (Экспорт в Excel) - готова к старту
