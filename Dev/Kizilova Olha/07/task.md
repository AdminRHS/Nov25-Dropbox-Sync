# Детальные задачи по CRM системе (Таланты)

**Дата:** 07.11.2025
**Источник:** Перенесено из 06/task.md (невыполненные задачи)

---

## ЗАДАЧА 1: Автоматическая деактивация уволенных сотрудников

**Описание:** Если сотрудник уволен, автоматически ставить его как забаненного (неактивного)

### Подзадачи:

#### 1.1 Backend - Логика деактивации
- [ ] Определить статус "уволен" в системе (какое значение в БД?)
- [ ] Создать поле `is_active` или `is_banned` в таблице talents (если нет)
- [ ] Написать логику: при смене статуса на "уволен" → автоматически `is_active = false`
- [ ] Добавить проверку: забаненный сотрудник не может войти в систему
- [ ] Написать миграцию БД для нового поля (если требуется)

#### 1.2 Frontend - Отображение
- [ ] Показывать индикатор "Неактивен" для забаненных сотрудников
- [ ] Заблокировать возможность редактирования неактивных сотрудников
- [ ] Добавить фильтр "Активные/Неактивные" в список талантов

#### 1.3 Права доступа
- [ ] Только админ может разбанить сотрудника
- [ ] Добавить подтверждение при бане: "Вы уверены, что хотите деактивировать сотрудника?"

#### 1.4 Тестирование
- [ ] Протестировать: уволенный сотрудник → автоматически banned
- [ ] Протестировать: забаненный не может войти в систему
- [ ] Протестировать: админ может разбанить

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend) + Лиля (frontend)
**Оценка времени:** 3-4 часа

---

## ЗАДАЧА 2: Объединение Notes и резюме в одно поле

**Описание:** Перенести все Notes и резюме в одно поле

### Подзадачи:

#### 2.1 Анализ текущей структуры
- [ ] Проверить где сейчас хранятся Notes (поле, таблица)
- [ ] Проверить где сейчас хранится Resume/CV (поле, таблица, файл?)
- [ ] Определить формат нового объединенного поля

#### 2.2 Backend - Миграция данных
- [ ] Создать новое поле `unified_notes` (или переименовать существующее)
- [ ] Написать скрипт миграции:
  - Объединить данные из Notes и Resume
  - Сохранить в новое поле
  - Формат: "Notes: [текст]\n\nResume: [текст]" или JSON
- [ ] Создать backup перед миграцией
- [ ] Выполнить миграцию на dev-среде
- [ ] Проверить результаты миграции

#### 2.3 Backend - API
- [ ] Обновить API endpoint для получения объединенных notes
- [ ] Обновить API endpoint для сохранения объединенных notes
- [ ] Удалить старые поля Notes и Resume (или пометить deprecated)

#### 2.4 Frontend - Интерфейс
- [ ] Создать единое поле редактирования для Notes + Resume
- [ ] Добавить разделители или вкладки внутри поля (опционально)
- [ ] Обновить отображение в карточке таланта
- [ ] Обновить отображение в списке талантов

#### 2.5 Тестирование
- [ ] Протестировать: старые данные корректно объединены
- [ ] Протестировать: можно редактировать объединенное поле
- [ ] Протестировать: данные сохраняются корректно
- [ ] Протестировать: нет потери данных при миграции

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend + миграция) + Лиля (frontend)
**Оценка времени:** 4-6 часов
**Риск:** Миграция данных - нужен тщательный backup

---

## ЗАДАЧА 3: Система коротких ссылок (самостоятельное управление)

**Описание:** Реализовать систему коротких ссылок, которой можем управлять сами

### Подзадачи:

#### 3.1 Анализ требований
- [ ] Определить: для чего нужны короткие ссылки? (шеринг профилей, приглашения?)
- [ ] Определить формат: `domain.com/t/ABC123` или `domain.com/short/XYZ`
- [ ] Определить длину короткой ссылки (6-8 символов?)
- [ ] Определить: уникальные или можно повторы?

#### 3.2 Backend - Таблица ссылок
- [ ] Создать таблицу `short_links`:
  - `id` (primary key)
  - `short_code` (уникальный код, varchar(10))
  - `original_url` (полный URL)
  - `talent_id` (FK к таланту, если применимо)
  - `created_by` (кто создал)
  - `created_at`
  - `expires_at` (опционально)
  - `clicks_count` (счетчик переходов)
- [ ] Создать миграцию для новой таблицы

#### 3.3 Backend - Генерация коротких ссылок
- [ ] Функция генерации уникального short_code (base62, nanoid, или custom)
- [ ] Проверка на уникальность кода
- [ ] API endpoint: `POST /api/short-links` - создать короткую ссылку
- [ ] API endpoint: `GET /api/short-links/:code` - получить оригинальный URL
- [ ] API endpoint: `GET /api/short-links` - список всех коротких ссылок
- [ ] API endpoint: `DELETE /api/short-links/:id` - удалить короткую ссылку

#### 3.4 Backend - Редирект
- [ ] Создать роут `GET /:short_code` - редирект на оригинальный URL
- [ ] Увеличивать счетчик `clicks_count` при каждом переходе
- [ ] Обработка: если short_code не найден → 404
- [ ] Обработка: если ссылка истекла → показать сообщение

#### 3.5 Frontend - Управление ссылками
- [ ] Страница управления короткими ссылками
- [ ] Кнопка "Создать короткую ссылку" в карточке таланта
- [ ] Показывать: short_code, original_url, количество кликов
- [ ] Кнопка "Копировать ссылку" (copy to clipboard)
- [ ] Возможность удалить короткую ссылку

#### 3.6 Аналитика
- [ ] Показывать количество переходов по каждой ссылке
- [ ] Опционально: дата последнего перехода
- [ ] Опционально: статистика по дням

#### 3.7 Тестирование
- [ ] Тест: создание короткой ссылки
- [ ] Тест: редирект работает корректно
- [ ] Тест: счетчик кликов увеличивается
- [ ] Тест: уникальность short_code
- [ ] Тест: удаление ссылки

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend) + Лиля (frontend)
**Оценка времени:** 1 день (6-8 часов)

---

## ЗАДАЧА 4: Ссылки отдельной таблицей (как в старой CRM)

**Описание:** Хранить все ссылки таланта в отдельной таблице (как в прошлой CRM)

### Подзадачи:

#### 4.1 Анализ старой структуры
- [ ] Посмотреть как было реализовано в старой CRM
- [ ] Определить какие типы ссылок нужны:
  - LinkedIn
  - Portfolio
  - GitHub
  - Behance
  - Facebook
  - Instagram
  - Другие социальные сети
  - Личный сайт
  - Другие

#### 4.2 Backend - Таблица ссылок
- [ ] Создать таблицу `talent_links`:
  - `id` (primary key)
  - `talent_id` (FK к таланту)
  - `link_type` (тип: linkedin, portfolio, github, etc.)
  - `url` (полный URL)
  - `label` (название ссылки, опционально)
  - `is_primary` (основная ссылка для этого типа?)
  - `created_at`
  - `updated_at`
- [ ] Создать миграцию для новой таблицы

#### 4.3 Backend - Миграция существующих ссылок
- [ ] Найти все поля со ссылками в текущей структуре talent
- [ ] Написать скрипт миграции:
  - Перенести LinkedIn URL → talent_links (type: linkedin)
  - Перенести Portfolio URL → talent_links (type: portfolio)
  - Перенести другие URLs
- [ ] Backup перед миграцией
- [ ] Выполнить миграцию на dev

#### 4.4 Backend - API
- [ ] API endpoint: `GET /api/talents/:id/links` - получить все ссылки таланта
- [ ] API endpoint: `POST /api/talents/:id/links` - добавить ссылку
- [ ] API endpoint: `PUT /api/talents/:id/links/:linkId` - обновить ссылку
- [ ] API endpoint: `DELETE /api/talents/:id/links/:linkId` - удалить ссылку
- [ ] Валидация URL формата

#### 4.5 Frontend - Отображение ссылок
- [ ] Секция "Ссылки" в карточке таланта
- [ ] Показывать иконки для каждого типа ссылки (LinkedIn, GitHub, etc.)
- [ ] Ссылки кликабельны и открываются в новой вкладке
- [ ] Группировка по типам

#### 4.6 Frontend - Редактирование ссылок
- [ ] Кнопка "Добавить ссылку"
- [ ] Модальное окно / форма:
  - Select для выбора типа ссылки
  - Input для URL
  - Input для названия (опционально)
- [ ] Кнопка "Удалить" для каждой ссылки
- [ ] Возможность редактировать существующую ссылку

#### 4.7 Тестирование
- [ ] Тест: добавление новой ссылки
- [ ] Тест: редактирование ссылки
- [ ] Тест: удаление ссылки
- [ ] Тест: валидация URL
- [ ] Тест: миграция старых данных прошла корректно

**Приоритет:** HIGH (связано с задачей 3)
**Исполнитель:** Оля (backend + миграция) + Лиля (frontend)
**Оценка времени:** 1 день (6-8 часов)
**Зависимость:** Желательно сделать вместе с задачей 3 (система коротких ссылок)

---

## ЗАДАЧА 5: Просмотр медиа у таланта

**Описание:** Добавить возможность просмотра медиафайлов (фото, видео) в профиле таланта

### Подзадачи:

#### 5.1 Анализ требований
- [ ] Определить типы медиа:
  - Фото профиля
  - Портфолио (фото работ)
  - Видео-презентации
  - Скриншоты проектов
  - Другие документы (PDF резюме)
- [ ] Определить где хранить файлы (сервер, S3, Cloudinary?)
- [ ] Определить максимальный размер файла
- [ ] Определить форматы файлов (jpg, png, mp4, pdf?)

#### 5.2 Backend - Таблица медиафайлов
- [ ] Создать таблицу `talent_media`:
  - `id` (primary key)
  - `talent_id` (FK к таланту)
  - `media_type` (photo, video, document)
  - `file_name` (оригинальное имя файла)
  - `file_path` (путь к файлу на сервере/S3)
  - `file_url` (публичный URL)
  - `file_size` (размер в байтах)
  - `mime_type` (image/jpeg, video/mp4, etc.)
  - `title` (название, опционально)
  - `description` (описание, опционально)
  - `is_profile_photo` (это главное фото профиля?)
  - `sort_order` (порядок отображения)
  - `uploaded_by` (кто загрузил)
  - `created_at`
- [ ] Создать миграцию для новой таблицы

#### 5.3 Backend - Загрузка файлов
- [ ] API endpoint: `POST /api/talents/:id/media` - загрузить файл
  - Валидация типа файла
  - Валидация размера файла
  - Генерация уникального имени файла
  - Сохранение на сервере/S3
  - Создание thumbnail для фото (опционально)
- [ ] Обработка ошибок загрузки
- [ ] Ограничение: макс N файлов на таланта

#### 5.4 Backend - Получение медиа
- [ ] API endpoint: `GET /api/talents/:id/media` - получить все медиа таланта
- [ ] API endpoint: `GET /api/talents/:id/media/:mediaId` - получить конкретный файл
- [ ] API endpoint: `DELETE /api/talents/:id/media/:mediaId` - удалить файл
- [ ] API endpoint: `PUT /api/talents/:id/media/:mediaId` - обновить метаданные
- [ ] Генерация подписанных URL для приватных файлов (если нужно)

#### 5.5 Frontend - Галерея медиа
- [ ] Секция "Медиа" в карточке таланта
- [ ] Отображение фото в виде галереи (grid layout)
- [ ] Превью для видео (thumbnail + play button)
- [ ] Иконки для документов (PDF, DOC)
- [ ] Клик на фото → открытие в полноэкранном режиме (lightbox)
- [ ] Навигация между фото в lightbox (стрелки влево/вправо)

#### 5.6 Frontend - Загрузка медиа
- [ ] Кнопка "Добавить медиа" / "Загрузить файл"
- [ ] Drag & Drop зона для загрузки файлов
- [ ] Progress bar при загрузке
- [ ] Превью файла перед загрузкой
- [ ] Возможность добавить название и описание
- [ ] Кнопка "Сделать фото профиля" для фотографий

#### 5.7 Frontend - Управление медиа
- [ ] Кнопка "Удалить" для каждого файла
- [ ] Подтверждение при удалении
- [ ] Возможность редактировать название/описание
- [ ] Drag & Drop для изменения порядка фото
- [ ] Фильтр по типу: "Все / Фото / Видео / Документы"

#### 5.8 Видео плеер
- [ ] Встроенный видео плеер для MP4 файлов
- [ ] Контролы: play, pause, volume, fullscreen
- [ ] Поддержка различных форматов (mp4, webm, mov)

#### 5.9 Оптимизация
- [ ] Lazy loading для изображений
- [ ] Генерация thumbnails для больших фото
- [ ] Оптимизация размера изображений при загрузке
- [ ] CDN для быстрой загрузки (если используется)

#### 5.10 Тестирование
- [ ] Тест: загрузка фото
- [ ] Тест: загрузка видео
- [ ] Тест: загрузка документа (PDF)
- [ ] Тест: удаление файла
- [ ] Тест: установка фото профиля
- [ ] Тест: галерея отображается корректно
- [ ] Тест: lightbox работает
- [ ] Тест: валидация типа и размера файла

**Приоритет:** MEDIUM-HIGH
**Исполнитель:** Оля (backend + storage) + Лиля (frontend + UI)
**Оценка времени:** 2 дня (12-16 часов)
**Зависимость:** Нужно решить вопрос с хранилищем файлов (локально или S3/Cloudinary)

---

## ЗАДАЧА 6: Переделать на токены доступа (Token-based Authentication)

**Описание:** Переделать аутентификацию на token-based систему

### Подзадачи:

#### 6.1 Анализ текущей системы
- [ ] Проверить текущую систему аутентификации (сессии, cookies?)
- [ ] Определить проблемы текущей системы
- [ ] Выбрать тип токенов: JWT, OAuth2, или custom?
- [ ] Определить срок жизни токенов (access token, refresh token)

#### 6.2 Backend - Генерация токенов
- [ ] Установить библиотеку для работы с JWT (jsonwebtoken, jose, или аналог)
- [ ] Создать endpoint `/api/auth/login` - генерация access token
- [ ] Создать endpoint `/api/auth/refresh` - обновление токена
- [ ] Создать endpoint `/api/auth/logout` - инвалидация токена
- [ ] Определить payload токена (user_id, role, permissions, exp)
- [ ] Создать секретный ключ для подписи токенов (env variable)

#### 6.3 Backend - Валидация токенов
- [ ] Создать middleware для проверки токенов на каждом защищенном роуте
- [ ] Проверка: токен валидный и не истек
- [ ] Проверка: токен не в blacklist (для logout)
- [ ] Извлечение user данных из токена
- [ ] Обработка ошибок: expired token, invalid token, missing token

#### 6.4 Backend - Refresh Token механизм
- [ ] Создать таблицу `refresh_tokens`:
  - `id` (primary key)
  - `user_id` (FK к пользователю)
  - `token` (refresh token)
  - `expires_at`
  - `created_at`
  - `is_revoked` (отозван или нет)
- [ ] Логика обновления access token через refresh token
- [ ] Автоматическая очистка истекших refresh tokens

#### 6.5 Backend - Blacklist для logout
- [ ] Создать таблицу `token_blacklist` или использовать Redis
- [ ] При logout добавлять токен в blacklist
- [ ] Middleware проверяет не находится ли токен в blacklist

#### 6.6 Backend - Права доступа через токены
- [ ] Добавить roles/permissions в payload токена
- [ ] Middleware для проверки прав: `hasRole`, `hasPermission`
- [ ] Обновление прав без перелогина (короткий срок жизни access token)

#### 6.7 Frontend - Хранение токенов
- [ ] Решить где хранить токены:
  - localStorage (проще, но уязвимо к XSS)
  - httpOnly cookies (безопаснее)
  - sessionStorage
- [ ] Сохранение access token и refresh token после логина
- [ ] Автоматическое добавление токена в headers всех запросов

#### 6.8 Frontend - Interceptors для API
- [ ] Axios/Fetch interceptor: добавить токен в header `Authorization: Bearer {token}`
- [ ] Interceptor для обработки 401 Unauthorized
- [ ] Автоматическое обновление токена при получении 401
- [ ] Редирект на login если refresh token тоже истек

#### 6.9 Frontend - Автоматическое обновление токена
- [ ] Проверка срока жизни токена перед каждым запросом
- [ ] Автоматический refresh за N минут до истечения
- [ ] Обработка одновременных запросов при refresh

#### 6.10 Миграция существующих пользователей
- [ ] Создать миграцию для добавления полей токенов
- [ ] Backup текущей системы
- [ ] План постепенного перехода (старая + новая система параллельно?)
- [ ] Тестирование на dev среде

#### 6.11 Безопасность
- [ ] HTTPS обязательно для передачи токенов
- [ ] Защита от CSRF атак
- [ ] Rate limiting на login endpoint
- [ ] Логирование подозрительной активности (неудачные попытки входа)

#### 6.12 Тестирование
- [ ] Тест: успешный login → получение токенов
- [ ] Тест: защищенный endpoint требует токен
- [ ] Тест: истекший токен → 401
- [ ] Тест: refresh token обновляет access token
- [ ] Тест: logout инвалидирует токены
- [ ] Тест: права доступа проверяются корректно

**Приоритет:** HIGH
**Исполнитель:** Оля (backend) + Лиля (frontend - interceptors)
**Оценка времени:** 2-3 дня (16-24 часа)
**Зависимость:** После завершения deep research по системе доступов

---

## ЗАДАЧА 7: Статистика для рекрутеров

**Описание:** Вывести статистику для рекрутеров по их работе с кандидатами

### Подзадачи:

#### 7.1 Анализ требований
- [ ] Определить какую статистику нужно показывать:
  - Количество кандидатов по статусам
  - Конверсия по воронке (видео → интервью → approved)
  - Количество кандидатов добавленных за период
  - Среднее время на этапе
  - ТОП рекрутеров по результатам
  - Другие метрики
- [ ] Определить период: день, неделя, месяц, год, custom range?
- [ ] Определить фильтры: по департаменту, профессии, статусу

#### 7.2 Backend - Таблица статистики (опционально)
- [ ] Решить: считать on-the-fly или сохранять агрегированные данные?
- [ ] Если сохранять: создать таблицу `recruiter_stats`:
  - `id`
  - `recruiter_id`
  - `date`
  - `candidates_added` (количество добавленных)
  - `candidates_approved` (количество одобренных)
  - `candidates_rejected` (количество отклоненных)
  - `avg_time_to_approval` (среднее время до одобрения)
  - и т.д.

#### 7.3 Backend - API для статистики
- [ ] API endpoint: `GET /api/recruiters/:id/stats` - статистика конкретного рекрутера
- [ ] API endpoint: `GET /api/stats/recruiters` - общая статистика по всем рекрутерам
- [ ] Параметры фильтрации:
  - `start_date`, `end_date` (период)
  - `department` (департамент)
  - `profession` (профессия)
  - `status` (статус кандидата)
- [ ] Оптимизация запросов (индексы, агрегация)

#### 7.4 Backend - Расчет метрик
- [ ] Количество кандидатов по статусам (group by status)
- [ ] Конверсия: % кандидатов перешедших на следующий этап
- [ ] Среднее время на каждом этапе
- [ ] Тренды: сравнение с предыдущим периодом
- [ ] Рейтинг рекрутеров (сортировка по результатам)

#### 7.5 Frontend - Dashboard статистики
- [ ] Страница "Статистика рекрутеров"
- [ ] Карточки с ключевыми метриками:
  - Всего кандидатов
  - Одобрено
  - Отклонено
  - В процессе
- [ ] Фильтры: период, департамент, профессия

#### 7.6 Frontend - Графики и визуализация
- [ ] Установить библиотеку для графиков (Chart.js, Recharts, или аналог)
- [ ] График: количество кандидатов по статусам (pie chart)
- [ ] График: динамика добавления кандидатов (line chart)
- [ ] График: конверсия воронки (funnel chart)
- [ ] Таблица: рейтинг рекрутеров

#### 7.7 Frontend - Экспорт статистики
- [ ] Кнопка "Экспорт в Excel" для статистики
- [ ] Кнопка "Экспорт в PDF" (опционально)
- [ ] Формирование отчета с графиками

#### 7.8 Права доступа
- [ ] Рекрутер видит только свою статистику
- [ ] HR/Админ видят статистику всех рекрутеров
- [ ] Менеджер видит статистику своей команды

#### 7.9 Тестирование
- [ ] Тест: статистика считается корректно
- [ ] Тест: фильтры работают
- [ ] Тест: графики отображаются
- [ ] Тест: права доступа соблюдаются

**Приоритет:** MEDIUM
**Исполнитель:** Оля (backend + расчеты) + Лиля (frontend + графики)
**Оценка времени:** 2 дня (12-16 часов)
**Статус:** После обсуждения требований с командой

---

## ЗАДАЧА 9: Кнопка экспорта данных в Excel

**Описание:** Сделать кнопку для экспорта данных кандидатов в Excel файл

### Подзадачи:

#### 9.1 Анализ требований
- [x] Определить какие поля экспортировать:
  - ✅ ID
  - ✅ Name
  - ✅ Email
  - ✅ Department
  - ✅ Profession
  - ✅ Status
  - ✅ Last contact date
  - ✅ Link (профиль)
  - ✅ Recruiter (кто добавил)
  - Другие поля?
- [x] Формат файла: .xlsx (Excel) или .csv?
- [x] Экспортировать все или с фильтрами?

#### 9.2 Backend - Библиотека для Excel
- [x] Выбрать библиотеку:
  - Node.js: exceljs, xlsx, fast-excel
  - Python: openpyxl, pandas
  - Другие
- [x] Установить выбранную библиотеку

#### 9.3 Backend - API для экспорта
- [x] API endpoint: `GET /api/talents/export` - экспорт талантов в Excel
- [x] Параметры фильтрации (опционально):
  - `status` - экспортировать только с определенным статусом
  - `department` - только из департамента
  - `recruiter_id` - только от определенного рекрутера
  - `start_date`, `end_date` - за период
  - `ids[]` - экспорт выбранных талантов
- [x] Response: файл Excel для скачивания

#### 9.4 Backend - Генерация Excel файла
- [x] Получить данные талантов из БД
- [x] Создать Excel workbook
- [x] Добавить header row с названиями колонок
- [x] Заполнить данными (каждый талант = строка)
- [x] Форматирование:
  - Header: жирный шрифт, фон
  - Автоширина колонок
  - Фильтры на header row
- [x] Сохранить как buffer для отправки

#### 9.5 Backend - Оптимизация для больших данных
- [x] Streaming для больших файлов (>1000 записей)
- [x] Пагинация при чтении из БД
- [x] Ограничение на количество экспортируемых записей (макс 10000?)

#### 9.6 Frontend - Кнопка экспорта
- [x] Добавить кнопку "Экспорт в Excel" на странице списка талантов
- [x] Иконка Excel + текст кнопки
- [x] Loading state при генерации файла

#### 9.7 Frontend - Модальное окно настроек экспорта (опционально)
- [x] Модальное окно "Настройки экспорта":
  - Выбор полей для экспорта (checkbox список)
  - Выбор фильтров
  - Экспорт: "Все" или "Выбранные" таланты
- [x] Кнопка "Экспортировать"

#### 9.8 Frontend - Скачивание файла
- [x] Запрос к API endpoint
- [x] Получение blob файла
- [x] Автоматическое скачивание через `<a download>`
- [x] Имя файла: `talents_export_YYYY-MM-DD.xlsx`

#### 9.9 Frontend - Индикация прогресса
- [x] Progress bar при генерации (если долго)
- [x] Уведомление "Файл готов для скачивания"
- [x] Обработка ошибок (слишком много данных, timeout)

#### 9.10 Права доступа
- [x] Только HR/Админ/Рекрутеры могут экспортировать
- [x] Рекрутер экспортирует только своих кандидатов
- [x] Админ экспортирует всех

#### 9.11 Логирование экспорта
- [x] Записывать кто, когда, сколько записей экспортировал
- [x] Таблица `export_log`:
  - `id`
  - `user_id`
  - `export_type` (talents, jobs, etc.)
  - `records_count`
  - `filters` (JSON с фильтрами)
  - `created_at`

#### 9.12 Тестирование
- [x] Тест: экспорт создает корректный Excel файл
- [x] Тест: все поля присутствуют
- [x] Тест: фильтры работают
- [x] Тест: файл скачивается автоматически
- [x] Тест: права доступа соблюдаются
- [x] Тест: большое количество данных (стресс-тест)

**Приоритет:** HIGH
**Исполнитель:** Оля (backend + генерация Excel) + Лиля (frontend + UI)
**Оценка времени:** 1-1.5 дня (8-12 часов)
**Статус:** ✅ Выполнено
**Заметка:** Вместо старого скрипта, который был привязан к Bootstrap атрибутам 3CM

---

## ЗАДАЧА 10: Экспорт данных по attendance из старой CRM

**Описание:** Экспортировать данные по attendance (посещаемости) из старой CRM системы

### Подзадачи:

#### 10.1 Анализ структуры данных в старой CRM
- [ ] Изучить экспорты из старой CRM в папке `ExportCRMS`
- [ ] Найти где хранятся данные по attendance в старой CRM
- [ ] Определить структуру таблицы/полей attendance:
  - Какие поля есть (employee_id, date, status, hours, etc.)
  - Формат дат
  - Типы данных
  - Связи с другими таблицами (employees, projects, etc.)
- [ ] Определить объем данных (сколько записей)

#### 10.2 Анализ требований к экспорту
- [ ] Определить какие поля экспортировать:
  - Employee ID / Name
  - Date (дата посещения)
  - Status (присутствие, отсутствие, больничный, отпуск)
  - Hours worked (отработанные часы)
  - Project/Department (если применимо)
  - Notes/Comments (если есть)
  - Другие поля
- [ ] Определить период экспорта: все данные или за определенный период?
- [ ] Определить формат: Excel (.xlsx), CSV, или JSON?

#### 10.3 Подключение к старой CRM
- [ ] Определить способ доступа к данным старой CRM:
  - Прямое подключение к БД (если возможно)
  - Экспорт через API (если доступен)
  - Импорт из существующих экспортов (файлы в ExportCRMS)
- [ ] Если через БД: получить credentials и параметры подключения
- [ ] Если через файлы: определить формат и структуру файлов

#### 10.4 Backend - Скрипт экспорта
- [ ] Создать скрипт для извлечения данных attendance из старой CRM
- [ ] Обработка данных:
  - Парсинг дат и времени
  - Нормализация статусов
  - Обработка пустых значений
  - Валидация данных
- [ ] Поддержка фильтрации:
  - По периоду (start_date, end_date)
  - По сотруднику (employee_id)
  - По статусу (status)
  - По департаменту/проекту

#### 10.5 Backend - Генерация файла экспорта
- [ ] Использовать библиотеку для Excel (exceljs, xlsx, или аналог)
- [ ] Создать Excel workbook с данными attendance
- [ ] Структура файла:
  - Header row с названиями колонок
  - Данные по строкам
  - Форматирование: жирный header, автоширина колонок
  - Опционально: группировка по сотрудникам или датам
- [ ] Сохранение файла в указанную директорию

#### 10.6 Backend - Обработка больших объемов данных
- [ ] Streaming для больших файлов (>10000 записей)
- [ ] Пагинация при чтении из БД
- [ ] Прогресс-бар или логирование прогресса
- [ ] Обработка ошибок и таймаутов

#### 10.7 Backend - Валидация и очистка данных
- [ ] Проверка корректности дат
- [ ] Проверка формата статусов
- [ ] Обработка дубликатов
- [ ] Логирование проблемных записей
- [ ] Создание отчета о проблемах (если есть)

#### 10.8 Документация
- [ ] Документировать структуру экспортируемых данных
- [ ] Описать формат файла
- [ ] Создать пример экспортированного файла
- [ ] Инструкция по использованию скрипта

#### 10.9 Тестирование
- [ ] Тест: экспорт небольшого объема данных (100-1000 записей)
- [ ] Тест: экспорт большого объема данных (>10000 записей)
- [ ] Тест: фильтрация по периоду
- [ ] Тест: фильтрация по сотруднику
- [ ] Тест: корректность формата дат
- [ ] Тест: обработка пустых значений
- [ ] Тест: производительность на больших данных

#### 10.10 Интеграция (опционально)
- [ ] Если нужно: импорт данных в новую CRM систему
- [ ] Создать таблицу `attendance` в новой БД (если нужно)
- [ ] Скрипт миграции данных из экспорта в новую систему
- [ ] Валидация данных перед импортом

**Приоритет:** MEDIUM-HIGH
**Исполнитель:** Оля (backend + скрипты экспорта)
**Оценка времени:** 1-2 дня (8-16 часов)
**Зависимость:** Доступ к данным старой CRM (БД или файлы экспорта)

---

## ЗАДАЧА 11: Развернуть проект на хостинге для клиента

**Описание:** Развернуть CRM систему на хостинге для клиента (production deployment)

### Подзадачи:

#### 11.1 Выбор и подготовка хостинга
- [ ] Определить требования к хостингу:
  - Тип: VPS, Cloud (AWS, DigitalOcean, Hetzner), Shared hosting?
  - Минимальные характеристики сервера (CPU, RAM, Storage)
  - Бюджет и стоимость
- [ ] Выбрать провайдера хостинга
- [ ] Зарегистрировать/настроить аккаунт на хостинге
- [ ] Получить доступ к серверу (SSH, панель управления)

#### 11.2 Настройка сервера
- [ ] Установить операционную систему (Ubuntu/Debian/CentOS)
- [ ] Настроить базовую безопасность:
  - Настроить firewall (UFW или iptables)
  - Отключить root login через SSH
  - Настроить SSH ключи
  - Установить fail2ban
- [ ] Обновить систему: `apt update && apt upgrade`
- [ ] Создать пользователя для деплоя (не root)

#### 11.3 Установка необходимого ПО
- [ ] Установить Node.js (версия из package.json)
- [ ] Установить npm/yarn/pnpm (менеджер пакетов проекта)
- [ ] Установить базу данных:
  - PostgreSQL или MySQL (в зависимости от проекта)
  - Настроить пользователя и пароль БД
  - Настроить доступ (только localhost или с паролем)
- [ ] Установить Nginx (веб-сервер)
- [ ] Установить PM2 или аналогичный процесс-менеджер для Node.js
- [ ] Установить Git (для деплоя кода)

#### 11.4 Настройка базы данных
- [ ] Создать базу данных для production
- [ ] Создать пользователя БД с необходимыми правами
- [ ] Выполнить миграции БД на production
- [ ] Загрузить начальные данные (seeds) если нужно
- [ ] Настроить backup БД (автоматические бэкапы)
- [ ] Протестировать подключение к БД

#### 11.5 Настройка переменных окружения
- [ ] Создать `.env` файл для production
- [ ] Настроить переменные:
  - `NODE_ENV=production`
  - `DATABASE_URL` или параметры подключения к БД
  - `JWT_SECRET` (уникальный для production)
  - `API_URL` / `FRONTEND_URL`
  - Другие API ключи и секреты
- [ ] Убедиться что `.env` не попадает в Git (.gitignore)
- [ ] Безопасно передать секреты на сервер

#### 11.6 Деплой приложения
- [ ] Клонировать репозиторий на сервер
- [ ] Установить зависимости: `npm install --production`
- [ ] Собрать frontend (если нужно): `npm run build`
- [ ] Настроить PM2 для запуска приложения:
  - Создать ecosystem.config.js
  - Настроить автозапуск при перезагрузке сервера
  - Настроить логирование
- [ ] Запустить приложение через PM2
- [ ] Проверить что приложение запустилось корректно

#### 11.7 Настройка Nginx
- [ ] Создать конфигурацию Nginx для домена
- [ ] Настроить reverse proxy на Node.js приложение
- [ ] Настроить статические файлы (если есть)
- [ ] Настроить SSL сертификат (Let's Encrypt):
  - Установить Certbot
  - Получить SSL сертификат
  - Настроить автоматическое обновление
- [ ] Настроить редирект с HTTP на HTTPS
- [ ] Протестировать доступность сайта

#### 11.8 Настройка домена
- [ ] Настроить DNS записи:
  - A запись указывающая на IP сервера
  - CNAME для поддоменов (если нужно)
- [ ] Дождаться распространения DNS (может занять до 48 часов)
- [ ] Проверить доступность домена

#### 11.9 Настройка мониторинга и логирования
- [ ] Настроить логирование приложения:
  - Логи PM2
  - Логи Nginx
  - Логи приложения
- [ ] Настроить мониторинг (опционально):
  - Uptime monitoring (UptimeRobot, Pingdom)
  - Server monitoring (New Relic, DataDog, или простой скрипт)
- [ ] Настроить алерты при падении сервиса

#### 11.10 Оптимизация производительности
- [ ] Настроить кэширование (если нужно):
  - Redis для сессий/кэша
  - Nginx кэширование статики
- [ ] Настроить сжатие (gzip) в Nginx
- [ ] Оптимизировать размер bundle (frontend)
- [ ] Настроить CDN для статики (опционально)
- [ ] Протестировать производительность

#### 11.11 Безопасность
- [ ] Проверить что все порты закрыты кроме необходимых (80, 443, 22)
- [ ] Настроить rate limiting в Nginx
- [ ] Проверить что секреты не в коде
- [ ] Настроить CORS правильно (только нужные домены)
- [ ] Проверить настройки безопасности в приложении
- [ ] Настроить регулярные обновления системы

#### 11.12 Backup и восстановление
- [ ] Настроить автоматические бэкапы БД:
  - Ежедневные бэкапы
  - Хранение на отдельном сервере/S3
  - Ротация старых бэкапов
- [ ] Настроить бэкапы файлов (если есть загружаемые файлы)
- [ ] Протестировать восстановление из бэкапа
- [ ] Документировать процесс восстановления

#### 11.13 Документация
- [ ] Создать документацию по деплою:
  - Инструкция по развертыванию
  - Список переменных окружения
  - Структура сервера
  - Команды для управления (restart, logs, etc.)
- [ ] Документировать процесс обновления приложения
- [ ] Создать runbook для типичных проблем

#### 11.14 Тестирование production
- [ ] Протестировать все основные функции в production
- [ ] Проверить работу API endpoints
- [ ] Проверить работу frontend
- [ ] Проверить работу БД (запись/чтение)
- [ ] Проверить загрузку файлов (если есть)
- [ ] Проверить отправку email (если есть)
- [ ] Проверить производительность под нагрузкой

#### 11.15 Передача клиенту
- [ ] Предоставить клиенту доступы:
  - Доступ к панели управления хостингом (если нужно)
  - SSH доступ (опционально)
  - Доступ к БД (опционально)
- [ ] Передать документацию по деплою
- [ ] Обучить клиента базовым операциям (restart, logs)
- [ ] Настроить контакты для поддержки

**Приоритет:** HIGH
**Исполнитель:** Оля (DevOps + backend)
**Оценка времени:** 2-3 дня (16-24 часа)
**Зависимость:** Готовность проекта к production (завершение основных задач)
**Статус:** ✅ Выполнена

---

## ОБНОВЛЕННАЯ ИТОГОВАЯ ОЦЕНКА

### Общее время на невыполненные задачи (1-7, 9-10):
- **Задача 1:** 3-4 часа
- **Задача 2:** 4-6 часов
- **Задача 3:** 6-8 часов (1 день)
- **Задача 4:** 6-8 часов (1 день)
- **Задача 5:** 12-16 часов (2 дня)
- **Задача 6:** 16-24 часа (2-3 дня)
- **Задача 7:** 12-16 часов (2 дня)
- **Задача 9:** 8-12 часов (1-1.5 дня)
- **Задача 10:** 8-16 часов (1-2 дня)

**Итого:** ~75-110 часов (9-14 рабочих дней)

*Примечание: Задачи 8 (Вкладки по статусам) и 11 (Развернуть проект на хостинге) выполнены и не включены в оценку*

### Рекомендуемый порядок выполнения:

**Высокий приоритет (делать первыми):**
1. **Задача 9** - Экспорт в Excel (HIGH, готова к старту)
2. **Задача 10** - Экспорт attendance из старой CRM (MEDIUM-HIGH)
3. **Задача 4** - Ссылки в отдельной таблице (HIGH)
4. **Задача 6** - Token-based auth (HIGH, после deep research)

**Средний приоритет (делать параллельно):**
5. **Задача 5** - Медиа (MEDIUM-HIGH)
6. **Задача 3** - Короткие ссылки (MEDIUM)
7. **Задача 7** - Статистика рекрутеров (MEDIUM)

**Низкий приоритет (делать в конце):**
8. **Задача 2** - Объединение Notes (MEDIUM)
9. **Задача 1** - Автобан уволенных (MEDIUM)

### Распределение:

**Оля (Backend + DevOps):**
- Все задачи по созданию таблиц, миграций, API, токенов, экспорта, скриптов
- Оценка: 48-71 часов
- *Примечание: Задача 11 (деплой) выполнена и не включена в оценку*

**Лиля (Frontend):**
- Все задачи по интерфейсам, формам, отображению, графикам
- Оценка: 27-39 часов

---

**Дата создания:** 07.11.2025
**Источник:** Перенесено из 06/task.md
**Следующий шаг:** Начать с задачи 9 (Экспорт в Excel) - готова к старту
